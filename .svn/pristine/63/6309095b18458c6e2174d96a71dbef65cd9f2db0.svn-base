<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title></title>
    @*<link href="/Plugins/JFine.IOT/Content/css/lanrenzhijia.css" rel="stylesheet" />
        <link href="/Plugins/JFine.IOT/Content/css/idangerous.swiper.css" rel="stylesheet" />
        <script type="text/javascript" src="/Plugins/JFine.IOT/Content/js/jquery.js"></script>
        <script src="/Plugins/JFine.IOT/Content/js/highcharts.js?v=1.0.3"></script>
        <script src="/Plugins/JFine.IOT/Content/js/exporting.js"></script>
        <script src="/Plugins/JFine.IOT/Content/js/idangerous.swiper.js"></script>
        <script src="~/Content/js/signalR/jquery.signalR-2.2.3.min.js"></script>
        <script type="text/javascript" src="~/signalr/hubs"></script>*@

    <link href="/Plugins/JFine.IOT/Content/mobile/BUI/src/css/bui.css" rel="stylesheet" />
    <link href="/Plugins/JFine.IOT/Content/mobile/dialogM/mobile/need/layer.css" rel="stylesheet" />
    <link href="/Plugins/JFine.IOT/Content/mobile/BUI/src/css/framework-bui.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.css">
    <script src="/Plugins/JFine.IOT/Content/mobile/BUI/src/js/plugins/fastclick.js"></script>
    <script type="text/javascript" src="/Plugins/JFine.IOT/Content/js/jquery.js"></script>
    <script src="/Plugins/JFine.IOT/Content/mobile/BUI/src/js/bui.js"></script>
    <script src="/Plugins/JFine.IOT/Content/mobile/dialogM/mobile/layer.js"></script>
    <script src="~/Content/js/signalR/jquery.signalR-2.2.3.min.js"></script>
    <script type="text/javascript" src="~/signalr/hubs"></script>

    <style type="text/css">
        .bui-slide .bui-slide-head {
            bottom: 0;
        }

        .slide-nav {
            margin-bottom: .2rem;
            background-color: #ffffff;
        }

            .slide-nav .bui-btn {
                border: 0;
            }

            .slide-nav .icons-round {
                width: 0.7rem;
                height: 0.7rem;
                line-height: 0.7rem;
                text-align: center;
                /*background: #01a5e4;*/
                border-radius: .15rem;
                margin: 0.15rem auto;
            }

                .slide-nav .icons-round i {
                    font-size: 0.4rem;
                    color: #fff;
                    margin: 0;
                }

            .slide-nav .span1 {
                margin-bottom: 0.1rem;
            }

            .slide-nav .bui-slide-head {
                text-align: center;
                background: #fff;
                width: 100%;
                text-align: center;
                height: 0.4rem;
            }

        .bui-slide .bui-slide-head ul li {
            float: none;
            display: inline-block;
            background: #0072c5;
            width: 0.15rem;
            height: 0.15rem;
            margin-bottom: 0;
        }
        /* 顶部滚动按钮 */
        .index-nav {
            background-color: #ffffff;
            padding-top: 0.1rem;
        }

            .index-nav .span1 {
                font-size: 0.2rem;
            }

        .btn-RL {
            background-color: #d71f6f;
        }

        .btn-QT {
            background-color: #ae7540;
        }

        .btn-blue {
            background-color: #00a5e2;
        }

        .btn-red {
            background-color: #f57070;
        }

        .btn-orange {
            background-color: #ffb33e;
        }

        .btn-green {
            background-color: #6cc96c;
        }

        .btn-thinblue {
            background-color: #6cc96c;
        }

        .bui-slide .bui-slide-head ul li {
            background-color: #d9d9d9;
        }

            .bui-slide .bui-slide-head ul li.active {
                background-color: #0072c5;
            }

        .slide-nav .bui-fluid-space [class*=span] {
            padding-left: 0;
            padding-right: 0;
        }
        /* 最新课程滚动 */
        .newcourse-panel {
            margin-top: 0;
            margin-bottom: .5rem;
        }

            .newcourse-panel .bui-panel-head {
                border-bottom: 0;
            }

        .slide-focus {
            background-color: #ffffff;
            overflow: visible !important;
        }

            .slide-focus .bui-slide-main li {
                padding: 0 0.2rem 0.2rem;
            }

            .slide-focus .bui-slide-head {
                height: 0.2rem;
                top: -0.45rem;
                left: 2rem;
            }

        .index-menu {
            background: #fff;
            border-top: 1px solid #eee;
            font-size: .24rem;
        }

            .index-menu .span6 {
                padding-top: .25rem;
                padding-bottom: .25rem;
                border-bottom: 1px solid #eee;
                border-right: 1px solid #eee;
            }

            .index-menu .ring {
                border: 2px solid #4ad1dd;
                width: .6rem;
                height: .6rem;
                line-height: .54rem;
                margin-left: .4rem;
                margin-right: .15rem;
            }

                .index-menu .ring .icon {
                    font-size: .32rem;
                    color: #4ad1dd;
                }

            .index-menu .ring02 {
                border-color: #49bc4a;
            }

                .index-menu .ring02 .icon {
                    color: #49bc4a;
                }

            .index-menu .ring03 {
                border-color: #fda10d;
            }

                .index-menu .ring03 .icon {
                    color: #fda10d;
                }

            .index-menu .ring04 {
                border-color: #f7696c;
            }

                .index-menu .ring04 .icon {
                    color: #f7696c;
                }


        .footer-nav {
            background: #fff;
        }

            .footer-nav .bui-btn .icon {
                height: 0.42rem;
            }

            .footer-nav .bui-btn {
                background-color: transparent;
            }

            .footer-nav .big-btn .icon {
                color: #ffffff;
                border-radius: 50%;
                background-color: #0aa9e3;
                height: 0.625rem;
                width: 0.625rem;
                line-height: 0.625rem;
                font-size: 0.55rem;
            }

        .shortcut-nav {
            margin-top: 0.2rem;
            margin-bottom: 0.2rem;
        }

            .shortcut-nav [class*=bui-btn] {
                padding: 0.15rem 0;
                border: none;
            }

                .shortcut-nav [class*=bui-btn] .icon {
                    color: #ffffff;
                    height: 0.7rem;
                    width: 0.7rem;
                    border-radius: 50%;
                    line-height: 0.7rem;
                    margin: 0.1rem auto;
                    font-size: .5rem;
                }
            /* 快捷入口导航 */
            .shortcut-nav .bui-btn {
                padding: 0.1rem 0;
                border-right: 1px solid #eee;
                border-bottom: 1px solid #eee;
            }

                .shortcut-nav .bui-btn .icon {
                    color: #ffffff;
                    height: 1.2rem;
                    width: 1.2rem;
                    border-radius: 50%;
                    line-height: 1.2rem;
                    margin: 0.3rem auto;
                    font-size: 0.8rem;
                }

        .short1 {
            background-color: #6cc96c;
        }

        .short2 {
            background-color: #6cc96c;
        }

        .short3 {
            background-color: #ffb33e;
        }

        .short4 {
            background-color: #00a5e2;
        }

        .short5 {
            background-color: #f57070;
        }

        .short6 {
            background-color: #6cc96c;
        }

        /* 顶部圆环 */
        .header-img {
            height: 5.4rem;
            background-color: #39a4ff;
        }
        /* 快捷入口 */
        .shortcut-nav .bui-box-vertical > [class*=span] {
            font-size: 0.32rem;
            padding-bottom: 0.3rem;
        }


        /*圆圈旋转动画*/
        .round-animate {
            width: 4rem;
            height: 4rem;
            overflow: hidden;
            margin: 0 auto;
            position: relative;
        }

            .round-animate img {
                max-width: 100%;
                max-height: 100%;
                vertical-align: top;
            }

            .round-animate .round-scan-light,
            .round-animate .round-scan,
            .round-animate .round-light,
            .round-animate .round-inner,
            .round-animate .round-outer {
                width: 100%;
                height: 100%;
                background: url("images/round/round-outer.png") center no-repeat;
                background-size: auto 100%;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 10;
            }

            .round-animate .round-light {
                background-image: url("images/round/round-light.png");
            }

            .round-animate .round-inner {
                background-image: url("images/round/round-inner.png");
            }

            .round-animate .round-scan {
                background-image: url("images/round/round-scan.png");
            }

            .round-animate .round-scan-light {
                background-image: url("images/round/round-scan-light.png");
            }
        /*动画CSS*/
        .animate-rotation {
            -webkit-animation: rotate 30s infinite linear;
            animation: rotate 30s infinite linear;
        }

        .animate-rotation-reverse {
            -webkit-animation: rotateReverse 4s infinite ease-out;
            animation: rotateReverse 4s infinite ease-out;
        }

        .animate-rotation-inner {
            -webkit-animation: rotateReverse 8s infinite linear;
            animation: rotateReverse 8s infinite linear;
        }

        .animate-zoom {
            -webkit-animation: zoom 1s infinite ease-out;
            animation: zoom 1s infinite ease-out;
        }

        .animate-translateY {
            -webkit-animation: translateY 4s infinite ease-out;
            animation: translateY 4s infinite ease-out;
        }

        .blockDiv {
            float: left;
            width: 100%;
            margin-left: 0.3%;
            margin-top: 0.3%;
            background-color: #f5f5f5;
        }

        .titleDiv {
            position: relative;
            width: 100%;
            height: 20%;
            background-color: #7385eb;
            color: #FFFFFF;
            padding-top: 0px;
            text-align: center;
        }

        .titleSpan {
            font-size: 15px;
            text-align: center;
            position: relative;
        }

        .imgDiv {
            position: relative;
            width: 100%;
            height: 25%;
            float: left;
        }

        .bottomDiv {
            position: relative;
            width: 100%;
            height: 65%;
            background-color: green;
            float: left;
        }
    </style>
    <script>
        var modbusHub;
        var pageview = {};
        var deviceStatus_Request ="";
              //var deviceStatus_Request = @Request.Params["deviceStatus"];
        $(function () {
            var liList = $("#slidemain").find("ul li");
            var deviceParaConfig = eval("(" + @Html.Raw(Json.Encode(ViewBag.DeviceParamList)) + ")");
            receiveData(deviceParaConfig);
            $.each(liList, function () {
                $(this).css("width", "100%");

            })

        })
        //接收数据初始化
        function receiveData(deviceParaConfig) {
            // Declare a proxy to reference the hub.
            modbusHub = $.connection.modbus;
            modbusHub.client.ReceiveData = function (deviceCode, paraType, paraCategory, paraCode, data, dataTime) {
                console.log("接收到数据");
                for (var i = 0; i < deviceParaConfig.length; i++) {
                    if (deviceParaConfig[i].Code == paraCategory) {
                        $("#deviceStatus_" + deviceCode).text(deviceParaConfig[i].Remark);
                        $("#bottomDiv_" + deviceCode).css("background-color", relativeColor(paraCategory));
                    }
                    //根据接收的状态参数，隐藏显示状态列
                    if (deviceStatus_Request == deviceParaConfig[i].Remark) {
                        $("#deviceStatus_" + deviceCode).css("display", "block");
                    }
                }
                //生产数量+1
                $("#produceQ_" + deviceCode).text(parseInt($("#produceQ_" + deviceCode).text()) + 1);


            };
            modbusHub.client.ReceiveQuantitySignal = function (deviceCode, beat, dataTime) {
                console.log("接收到数据");
                $("#produceBeat_" + deviceCode).text(beat);
            };
            // Start the connection.
            $.connection.hub.start().done(function () {
                console.log("modbusHub已连接");
            });

        }
        function relativeColor(Code) {
            switch (Code) {
                case 1:
                    return "orange"
                    break;
                case 2:
                    return "gray";
                    break;
                default:
                    return "green";
                    break;
            }
        }
    </script>
</head>
<body ontouchstart>
    <div id="page" class="bui-page" style="overflow:auto">
        <header id="bar" class="bui-bar">
            <div class="bui-bar">
                <div class="bui-bar-left">
                </div>
                <div class="bui-bar-main">设备详情</div>
                <div class="bui-bar-right">
                </div>
            </div>
        </header>
        <main>

            <div id="slide" class="bui-slide slide-nav" style="margin-bottom: 0rem">
                <div id="slidemain" class="bui-slide-main">
                    <!-- 快捷入口 -->
                    <ul class="bui-nav shortcut-nav bui-fluid">
                        @using System.Data;
                        @foreach (DataRow item in ViewBag.DiviceList.Rows)
                        {
                            string color = item["Status"].ToString() == "0" ? "gray" : "green";
                            <li class="bui-btn bui-box-vertical span5 " style="background-color:green;width:100%">
                                <div class="blockDiv">
                                    <div class="titleDiv"><span class="titleSpan">机器编号:@item["Name"]</span></div>
                                    <div class="imgDiv"><img style="width:50%;height:100%;" src="/Plugins/JFine.IOT/Content/images/machine1.jpg" /></div>
                                    <div class="bottomDiv" style="background-color:@color" id="bottomDiv_@item["Code"]">
                                        <div style="margin-top:6px;margin-left:15px;text-align:left">
                                            <span style="font-size:18px;color:#ffff;display:block">设备状态:<span id="deviceStatus_@item["Code"]" style=""></span></span>
                                        </div>
                                        <div style="float:left;margin-left:15px;text-align:left">
                                            <span style="font-size:18px;color:#ffff;display:block">工单号:<span id="orderNum_@item["Code"]">@item["OrderNum"]</span></span>
                                            <span style="font-size:18px;color:#ffff;display:block">工单数量:<span id="orderQuantity_@item["Code"]">@item["Quantity"]</span></span>
                                            <span style="font-size:18px;color:#ffff;display:block">标准节拍:<span id="stardardBeat_@item["Code"]">@item["StandardBeat"]</span></span>
                                        </div>
                                        <div style="float:left;margin-left:60px;text-align:left">
                                            <span style="font-size:18px;color:#ffff;display:block">产品编号:<span id="pcode_@item["Code"]">@item["ProductCode"]</span></span>
                                            <span style="font-size:18px;color:#ffff;display:block">生产数量:<span id="produceQ_@item["Code"]">@item["dayQuantity"]</span></span>
                                            <span style="font-size:18px;color:#ffff;display:block">生产节拍:<span id="produceBeat_@item["Code"]"></span></span>
                                        </div>

                                    </div>
                                </div>
                            </li>
                        }


                    </ul>
                </div>
            </div>
        </main>
    </div>
</body>
</html>


