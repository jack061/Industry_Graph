<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--使用webkit内核-->
    <meta name="renderer" content="webkit">
    <meta name="renderer" content="ie-stand">
    <!--避免IE使用兼容模式-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1,IE=9" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
    <title></title>
    <link href="/Plugins/JFine.IOT/Content/mobile/BUI/src/css/bui.css" rel="stylesheet" />
    <script src="/Plugins/JFine.IOT/Content/mobile/BUI/src/js/plugins/fastclick.js"></script>
    <script src="/Plugins/JFine.IOT/Content/mobile/BUI/src/js/bui.js"></script>
    <script src="/Plugins/JFine.IOT/Content/mobile/dialogM/mobile/layer.js"></script>
    <link href="/Plugins/JFine.IOT/Content/mobile/dialogM/mobile/need/layer.css" rel="stylesheet" />
    <link href="/Plugins/JFine.IOT/Content/mobile/BUI/src/css/framework-bui.css" rel="stylesheet" />
    <script src="/Plugins/JFine.IOT/Content/mobile/BUI/src/js/framework-bui.js"></script>
    <script src="/Plugins/JFine.IOT/Content/mobile/BUI/fly-zomm-img.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.css">
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/zepto.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.js"></script>
    <script src="~/Content/js/signalR/jquery.signalR-2.2.3.min.js"></script>
    <script type="text/javascript" src="~/signalr/hubs"></script>
    <style type="text/css">
        .bui-slide .bui-slide-head {
            bottom: 0;
        }

        .slide-nav {
            margin-bottom: .2rem;
            background-color: #ffffff;
        }

            .slide-nav .bui-btn {
                border: 0;
            }

            .slide-nav .icons-round {
                width: 0.7rem;
                height: 0.7rem;
                line-height: 0.7rem;
                text-align: center;
                /*background: #01a5e4;*/
                border-radius: .15rem;
                margin: 0.15rem auto;
            }

                .slide-nav .icons-round i {
                    font-size: 0.4rem;
                    color: #fff;
                    margin: 0;
                }

            .slide-nav .span1 {
                margin-bottom: 0.1rem;
            }

            .slide-nav .bui-slide-head {
                text-align: center;
                background: #fff;
                width: 100%;
                text-align: center;
                height: 0.4rem;
            }

        .bui-slide .bui-slide-head ul li {
            float: none;
            display: inline-block;
            background: #0072c5;
            width: 0.15rem;
            height: 0.15rem;
            margin-bottom: 0;
        }
        /* 顶部滚动按钮 */
        .index-nav {
            background-color: #ffffff;
            padding-top: 0.1rem;
        }

            .index-nav .span1 {
                font-size: 0.2rem;
            }

        .btn-RL {
            background-color: #d71f6f;
        }

        .btn-QT {
            background-color: #ae7540;
        }

        .btn-blue {
            background-color: #00a5e2;
        }

        .btn-red {
            background-color: #f57070;
        }

        .btn-orange {
            background-color: #ffb33e;
        }

        .btn-green {
            background-color: #6cc96c;
        }

        .btn-thinblue {
            background-color: #6cc96c;
        }

        .bui-slide .bui-slide-head ul li {
            background-color: #d9d9d9;
        }

            .bui-slide .bui-slide-head ul li.active {
                background-color: #0072c5;
            }

        .slide-nav .bui-fluid-space [class*=span] {
            padding-left: 0;
            padding-right: 0;
        }
        /* 最新课程滚动 */
        .newcourse-panel {
            margin-top: 0;
            margin-bottom: .5rem;
        }

            .newcourse-panel .bui-panel-head {
                border-bottom: 0;
            }

        .slide-focus {
            background-color: #ffffff;
            overflow: visible !important;
        }

            .slide-focus .bui-slide-main li {
                padding: 0 0.2rem 0.2rem;
            }

            .slide-focus .bui-slide-head {
                height: 0.2rem;
                top: -0.45rem;
                left: 2rem;
            }

        .index-menu {
            background: #fff;
            border-top: 1px solid #eee;
            font-size: .24rem;
        }

            .index-menu .span6 {
                padding-top: .25rem;
                padding-bottom: .25rem;
                border-bottom: 1px solid #eee;
                border-right: 1px solid #eee;
            }

            .index-menu .ring {
                border: 2px solid #4ad1dd;
                width: .6rem;
                height: .6rem;
                line-height: .54rem;
                margin-left: .4rem;
                margin-right: .15rem;
            }

                .index-menu .ring .icon {
                    font-size: .32rem;
                    color: #4ad1dd;
                }

            .index-menu .ring02 {
                border-color: #49bc4a;
            }

                .index-menu .ring02 .icon {
                    color: #49bc4a;
                }

            .index-menu .ring03 {
                border-color: #fda10d;
            }

                .index-menu .ring03 .icon {
                    color: #fda10d;
                }

            .index-menu .ring04 {
                border-color: #f7696c;
            }

                .index-menu .ring04 .icon {
                    color: #f7696c;
                }


        .footer-nav {
            background: #fff;
        }

            .footer-nav .bui-btn .icon {
                height: 0.42rem;
            }

            .footer-nav .bui-btn {
                background-color: transparent;
            }

            .footer-nav .big-btn .icon {
                color: #ffffff;
                border-radius: 50%;
                background-color: #0aa9e3;
                height: 0.625rem;
                width: 0.625rem;
                line-height: 0.625rem;
                font-size: 0.55rem;
            }

        .shortcut-nav {
            margin-top: 0.2rem;
            margin-bottom: 0.2rem;
        }

            .shortcut-nav [class*=bui-btn] {
                padding: 0.15rem 0;
                border: none;
            }

                .shortcut-nav [class*=bui-btn] .icon {
                    color: #ffffff;
                    height: 0.7rem;
                    width: 0.7rem;
                    border-radius: 50%;
                    line-height: 0.7rem;
                    margin: 0.1rem auto;
                    font-size: .5rem;
                }
            /* 快捷入口导航 */
            .shortcut-nav .bui-btn {
                padding: 0.1rem 0;
                border-right: 1px solid #eee;
                border-bottom: 1px solid #eee;
            }

                .shortcut-nav .bui-btn .icon {
                    color: #ffffff;
                    height: 1.2rem;
                    width: 1.2rem;
                    border-radius: 50%;
                    line-height: 1.2rem;
                    margin: 0.3rem auto;
                    font-size: 0.8rem;
                }

        .short1 {
            background-color: #6cc96c;
        }

        .short2 {
            background-color: #6cc96c;
        }

        .short3 {
            background-color: #ffb33e;
        }

        .short4 {
            background-color: #00a5e2;
        }

        .short5 {
            background-color: #f57070;
        }

        .short6 {
            background-color: #6cc96c;
        }

        /* 顶部圆环 */
        .header-img {
            height: 5.4rem;
            background-color: #39a4ff;
        }
        /* 快捷入口 */
        .shortcut-nav .bui-box-vertical > [class*=span] {
            font-size: 0.32rem;
            padding-bottom: 0.3rem;
        }


        /*圆圈旋转动画*/
        .round-animate {
            width: 4rem;
            height: 4rem;
            overflow: hidden;
            margin: 0 auto;
            position: relative;
        }

            .round-animate img {
                max-width: 100%;
                max-height: 100%;
                vertical-align: top;
            }

            .round-animate .round-scan-light,
            .round-animate .round-scan,
            .round-animate .round-light,
            .round-animate .round-inner,
            .round-animate .round-outer {
                width: 100%;
                height: 100%;
                background: url("images/round/round-outer.png") center no-repeat;
                background-size: auto 100%;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 10;
            }

            .round-animate .round-light {
                background-image: url("images/round/round-light.png");
            }

            .round-animate .round-inner {
                background-image: url("images/round/round-inner.png");
            }

            .round-animate .round-scan {
                background-image: url("images/round/round-scan.png");
            }

            .round-animate .round-scan-light {
                background-image: url("images/round/round-scan-light.png");
            }
        /*动画CSS*/
        .animate-rotation {
            -webkit-animation: rotate 30s infinite linear;
            animation: rotate 30s infinite linear;
        }

        .animate-rotation-reverse {
            -webkit-animation: rotateReverse 4s infinite ease-out;
            animation: rotateReverse 4s infinite ease-out;
        }

        .animate-rotation-inner {
            -webkit-animation: rotateReverse 8s infinite linear;
            animation: rotateReverse 8s infinite linear;
        }

        .animate-zoom {
            -webkit-animation: zoom 1s infinite ease-out;
            animation: zoom 1s infinite ease-out;
        }

        .animate-translateY {
            -webkit-animation: translateY 4s infinite ease-out;
            animation: translateY 4s infinite ease-out;
        }
    </style>
    <script>

        var pageview = {};
        var stateAssemble = [];
        $(function () {
            var liList = $("#slidemain").find("ul li");
            @*var deviceList = eval("(" + @Html.Raw(Json.Encode(ViewBag.DeviceList)) + ")");
            for (var i = 0; i < deviceList.length; i++) {
                    stateAssemble.push({ deviceCode:deviceList[i].Code, paraCategory: '2' });//初始化默认全部为断电停机
            }*@
            $.each(liList, function () {
                $(this).css("width", "50%");
                $(this).bind('click', function () {
                    window.location.href = "/IOT/IOTHome/DeviceBoard_M_Details";
                    //window.location.href("/IOT/IOTHome/DeviceBoard_M_Details");
                    //window.open("/IOT/IOTHome/DeviceBoard_M_Details");
                })
            })
            modbusHub = $.connection.modbus;
            modbusHub.client.ReceiveData = function (deviceCode, paraType, paraCategory, paraCode, data, dataTime) {
                console.log("接收到数据");
                //根据返回设备状态码更新设备各个状态下的数量
                    for (var i = 0; i < stateAssemble.length; i++) {
                        //若返回的状态存在，则不更新数量
                        if (stateAssemble[i].deviceCode == deviceCode && stateAssemble[i].paraCategory == paraCategory) {
                            return;
                        }
                        //设备存在但状态码不同，原状态数量-1，新状态数量+1
                        else if (stateAssemble[i].deviceCode == deviceCode) {
                            if (paraCategory>2) {//正常生产
                                var normalQuantity = $("ui li.device_normal span:eq(1)").text();
                                var multiQuantity = $("ui li[deviceCode='" + paraCategory + "'] span:eq(1)").text();
                                $("ui li.device_normal span:eq(1)").text(parseInt(normalQuantity) + 1);
                                $("ui li[deviceCode='" + paraCategory + "'] span:eq(1)").text(parseInt(multiQuantity) - 1);
                            }
                            else {
                                var originQuantity = $("ui li[deviceCode='" + stateAssemble[i].paraCategory + "'] span:eq(1)").text();
                                var currentQuantity = $("ui li[deviceCode='" + paraCategory + "'] span:eq(1)").text();
                                $("ui li[deviceCode='" + stateAssemble[i].paraCategory + "'] span:eq(1)").text(parseInt(originQuantity)-1);
                                $("ui li[deviceCode='" + paraCategory + "'] span:eq(1)").text(parseInt(currentQuantity)+1);
                            }
                            stateAssemble[i].paraCategory = paraCategory;
                        }
                    }



            };
            modbusHub.client.ReceiveQuantitySignal = function (deviceCode, beat, dataTime) {
                console.log("接收到数据");
            };
        })

    </script>
</head>
<body ontouchstart>
    <div id="page" class="bui-page">
        <header id="bar" class="bui-bar">
            <div class="bui-bar">
                <div class="bui-bar-left">
                </div>
                <div class="bui-bar-main">首页</div>
                <div class="bui-bar-right">
                </div>
            </div>
        </header>
        <main>
            <div class="section-title">注塑设备信息</div>
            <div id="slide" class="bui-slide slide-nav" style="margin-bottom: 0rem">
                <div id="slidemain" class="bui-slide-main">
                    <!-- 快捷入口 -->
                    <ul class="bui-nav shortcut-nav bui-fluid">
                        <li class="bui-btn bui-box-vertical span5 device_all" style="background-color:green"> <img src="/Content/images/whole.jpg" /></li>
                        <li class="bui-btn bui-box-vertical span5 device_all" style="background-color:green"> <img src="/Content/images/run.jpg" /></li>
                        <li class="bui-btn bui-box-vertical span5 device_all" style="background-color:green"> <img src="/Content/images/debug.jpg" /></li>
                        <li class="bui-btn bui-box-vertical span5 device_all" style="background-color:green"> <img src="/Content/images/offline.jpg" /></li>
                        <li class="bui-btn bui-box-vertical span5 device_all" style="background-color:green"> <img src="/Content/images/pause.jpg" /></li>
                        @*<li class="bui-btn bui-box-vertical span5 device_all" style="background-color:green"><i class="icon short3">&#xe65c;</i><div class="span1"><span style="color:white">全部：</span><span style="color:white">@ViewBag.DeviceList.Count</span></div></li>*@
                        @*<li class="bui-btn bui-box-vertical span5 device_normal" deviceCode="3" style="background-color:green"><i class="icon short3">&#xe65c;</i><div class="span1"><span style="color:white">正常生产：</span><span style="color:white">0</span></div></li>
                        <li class="bui-btn bui-box-vertical span5 device_idle" deviceCode="1" style="background-color:#d500ffed"><i class="icon short4">&#xe65c;</i><div class="span1"><span style="color:white">待机空闲：</span><span style="color:white">0</span></div></li>
                        <li class="bui-btn bui-box-vertical span5 device_break" deviceCode="2" style="background-color:gray"><i class="icon short5">&#xe65c;</i><div class="span1 "><span style="color:white">断电停机：</span><span style="color:white">@ViewBag.DeviceList.Count</span></div></li>
                        <li class="bui-btn bui-box-vertical span5 device_schedule" style="background-color:red"><i class="icon short6">&#xe65c;</i><div class="span1"><span style="color:white">计划停机：</span><span style="color:white">0</span></div></li>*@
                    </ul>
                </div>
            </div>
        </main>
    </div>
</body>
</html>


